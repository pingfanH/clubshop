import{r as a,q as e,c as t,w as o,n as s,i as r,o as l,a as i,f as n,k as m,R as u}from"./index-BVO1xZk6.js";import{_ as d,a as c,b as p}from"./u-form.tBBcXCwJ.js";import{r as f}from"./uni-app.es.BphbwsiZ.js";import{A as h}from"./index.xD-imUXR.js";import{i as v,p as b}from"./user.CHXC6lKF.js";import{i as _}from"./upload.7mDP2xs3.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"../config.js";import"./u-icon.-KBhdZC3.js";import"./emitter.DrjJCwnj.js";const k={nickName:[{required:!0,message:"请输入用户昵称",trigger:["blur","change"]}]};const I=g({components:{AvatarImage:h},data:()=>({disabled:!1,avatarUrl:"",tempFile:null,form:{avatarId:"",nickName:""},rules:k}),onLoad(){this.getUserInfo()},onReady(){this.$refs.uForm.setRules(this.rules)},methods:{getUserInfo(){const a=this;v().then((e=>{const t=e.data.userInfo;a.avatarUrl=t.avatar_url,a.form.avatarId=t.avatar_id,a.form.nickName=t.nick_name}))},onClickAvatar(){this.chooseImage()},onChooseAvatar({detail:a}){},chooseImage(){const a=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success({tempFiles:e}){a.tempFile=e[0],a.avatarUrl=a.tempFile.path}})},uploadFile(){const a=this;return _([a.tempFile]).then((e=>(a.form.avatarId=e[0],a.tempFile=null,!0))).catch((()=>!1))},async handleSubmit(){const a=this;!0!==a.disabled&&a.$refs.uForm.validate((async e=>{if(e){if(a.disabled=!0,a.tempFile&&!(await a.uploadFile()))return a.$toast("很抱歉，头像上传失败"),void(a.disabled=!1);b({form:a.form}).then((e=>{a.$toast(e.message),setTimeout((()=>{a.disabled=!1,uni.navigateBack()}),1500)})).catch((e=>a.disabled=!1))}}))},onInputNickName(a){a&&(this.form.nickName=a)}}},[["render",function(h,v,b,_,g,k){const I=r,F=a("avatar-image"),N=u,j=f(e("u-form-item"),d),y=f(e("u-input"),c),C=f(e("u-form"),p);return l(),t(I,{class:"container",style:s(h.appThemeStyle)},{default:o((()=>[i(I,{class:"page-title"},{default:o((()=>[n("个人信息")])),_:1}),i(I,{class:"form-wrapper"},{default:o((()=>[i(C,{model:g.form,ref:"uForm","label-width":"140rpx"},{default:o((()=>[i(j,{label:"头像"},{default:o((()=>[i(N,{class:"btn-normal","open-type":"chooseAvatar",onClick:v[0]||(v[0]=a=>k.onClickAvatar()),onChooseavatar:k.onChooseAvatar},{default:o((()=>[i(F,{url:g.avatarUrl,width:100},null,8,["url"])])),_:1},8,["onChooseavatar"])])),_:1}),i(j,{label:"昵称",prop:"nickName"},{default:o((()=>[i(y,{modelValue:g.form.nickName,"onUpdate:modelValue":v[1]||(v[1]=a=>g.form.nickName=a),type:"nickname",maxlength:"30",placeholder:"请输入昵称",onInput:k.onInputNickName,onBlur:k.onInputNickName},null,8,["modelValue","onInput","onBlur"])])),_:1})])),_:1},8,["model"])])),_:1}),i(I,{class:"footer"},{default:o((()=>[i(I,{class:"btn-wrapper"},{default:o((()=>[i(I,{class:m(["btn-item btn-item-main",{disabled:g.disabled}]),onClick:v[2]||(v[2]=a=>k.handleSubmit())},{default:o((()=>[n("保存")])),_:1},8,["class"])])),_:1})])),_:1})])),_:1},8,["style"])}],["__scopeId","data-v-3820795e"]]);export{I as default};
